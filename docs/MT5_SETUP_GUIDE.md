# MetaTrader5 (MT5) DEMO口座セットアップガイド

このガイドでは、FX自動トレードシステムをMT5のDEMO口座に接続する方法を説明します。

## 前提条件

- Windows OS（MT5はWindowsネイティブアプリケーション）
- インターネット接続

## ステップ1: MetaTrader5のインストール

### 1.1 ダウンロード

公式サイトからMT5をダウンロードします：

```
https://www.metatrader5.com/ja/download
```

### 1.2 インストール

1. ダウンロードした`mt5setup.exe`を実行
2. インストールウィザードに従ってインストール
3. インストール完了後、MT5が自動的に起動します

## ステップ2: DEMO口座の開設

### 2.1 新規デモ口座の作成

1. MT5を起動
2. メニューから「**ファイル**」→「**デモ口座を開く**」を選択
3. ブローカー選択画面が表示されます

### 2.2 ブローカーの選択

推奨ブローカー（日本語対応）：
- **OANDA Japan** - 日本の金融庁登録業者
- **XMTrading** - 海外業者（日本語サポート充実）
- **FXTF** - 日本の金融庁登録業者
- **外為ファイネスト** - 日本の金融庁登録業者

検索バーにブローカー名を入力して選択します。

### 2.3 口座タイプの選択

以下の設定を推奨：

| 項目 | 推奨値 | 説明 |
|------|--------|------|
| **口座タイプ** | Standard | 通常の口座タイプ |
| **口座通貨** | JPY | 日本円 |
| **レバレッジ** | 1:25 | 日本の個人口座の最大レバレッジ |
| **初期証拠金** | 1,000,000 JPY | 100万円（DEMO口座なので自由に設定可） |

### 2.4 個人情報の入力

- 名前（テスト用なので任意）
- メールアドレス（通知を受け取る場合は有効なアドレス）
- 電話番号（任意）

### 2.5 口座情報の保存

口座作成が完了すると、以下の情報が表示されます：

```
ログイン（口座番号）: 12345678
パスワード: Abc123XYZ
サーバー: Demo-Server-01
```

**この情報を必ずメモしてください！**

## ステップ3: MT5の動作確認

### 3.1 ログイン確認

1. MT5の左上に口座番号とサーバー名が表示されているか確認
2. 右下のステータスバーに接続状態が表示されているか確認
   - 緑色：接続成功
   - 赤色：接続失敗

### 3.2 チャート表示

1. メニュー「**表示**」→「**銘柄**」を選択
2. 「Forex」→「USDJPY」を探してダブルクリック
3. チャートが表示されることを確認

## ステップ4: 環境変数の設定

### 4.1 .envファイルの作成

プロジェクトルートの`.env.template`をコピーして`.env`ファイルを作成：

```powershell
copy .env.template .env
```

### 4.2 MT5接続情報の設定

`.env`ファイルを編集して、ステップ2.5で取得した情報を設定：

```env
# MetaTrader5設定
MT5_LOGIN=12345678
MT5_PASSWORD=Abc123XYZ
MT5_SERVER=Demo-Server-01
```

**重要事項：**
- パスワードは大文字・小文字を区別します
- サーバー名は正確に入力してください（スペースや記号も含む）
- `.env`ファイルは絶対にGitにコミットしないでください

### 4.3 その他の環境変数

Gemini APIキーも必須です：

```env
# Gemini API設定
GEMINI_API_KEY=your_actual_api_key_here
```

APIキーの取得方法：
```
https://aistudio.google.com/app/apikey
```

## ステップ5: 接続テスト

### 5.1 MT5を起動した状態で実行

**重要：phase4_sample.pyを実行する前に、MT5を起動しておいてください！**

```powershell
# 仮想環境を有効化
.\venv\Scripts\activate

# サンプルスクリプトを実行
python phase4_sample.py
```

### 5.2 成功時の出力例

```
【ステップ3】トレード実行（MT5 DEMO口座接続）...
✓ MT5 DEMO口座に接続しました
実行結果: ✓ SUCCESS
メッセージ: Trade executed successfully: ticket=123456789
```

### 5.3 失敗時の対処法

#### エラー: "MT5接続情報が設定されていません"

- `.env`ファイルが存在するか確認
- MT5_LOGIN、MT5_PASSWORD、MT5_SERVERが設定されているか確認

#### エラー: "MT5への接続に失敗しました"

**原因1：MT5が起動していない**
- MT5を起動してから再実行

**原因2：ログイン情報が間違っている**
- MT5で手動ログインを試して、情報が正しいか確認
- サーバー名が完全一致しているか確認（スペース、ハイフンなど）

**原因3：DEMO口座の期限切れ**
- DEMO口座は通常30日で期限切れになります
- 期限切れの場合は、新しいDEMO口座を作成してください

**原因4：サーバーメンテナンス**
- ブローカーのサーバーがメンテナンス中の可能性
- 時間をおいて再度試してください

#### エラー: "Authorization failed (-6)"

- パスワードが間違っている可能性が高い
- MT5で手動ログアウト→ログインを試してください
- 正しくログインできたら、そのパスワードを`.env`に設定

## ステップ6: MT5の基本操作

### 6.1 ポジションの確認

MT5の「**ツールボックス**」タブ→「**取引**」タブで、現在のポジションを確認できます。

### 6.2 自動売買の有効化

自動売買を実行する際は、MT5の「**ツール**」→「**オプション**」→「**エキスパートアドバイザー**」タブで以下を設定：

- ☑ アルゴリズム取引を許可する
- ☑ DLLの使用を許可する（チェックしない）

### 6.3 ログの確認

MT5の「**ツールボックス**」タブ→「**エキスパート**」タブで、自動売買のログを確認できます。

## トラブルシューティング

### Q1: MT5がインストールできない

**A:** 管理者権限でインストールを試してください。また、アンチウイルスソフトが干渉している可能性があります。

### Q2: ブローカーが見つからない

**A:** 検索バーに正確なブローカー名を入力してください。見つからない場合は、ブローカーの公式サイトからMT5専用リンクを使用してください。

### Q3: DEMO口座の有効期限は？

**A:** 通常30日間有効です。期限が切れたら、新しいDEMO口座を作成してください（何度でも作成可能）。

### Q4: リアル口座でも使えますか？

**A:** はい、リアル口座でも使用可能です。ただし、**十分なテストを行ってから**リアル口座に移行してください。リアル口座の場合は、実際の資金が動きますので、自己責任でご利用ください。

### Q5: MT5がフリーズする

**A:** MT5を再起動してください。それでも解決しない場合は、MT5を再インストールしてください。

## セキュリティ注意事項

### 重要な注意事項

1. **パスワードの管理**
   - `.env`ファイルを他人に見せないでください
   - Gitにコミットしないでください（`.gitignore`で除外済み）

2. **DEMO口座の限定使用**
   - 初めてシステムを使う場合は、必ずDEMO口座で十分にテストしてください
   - 少なくとも1ヶ月はDEMO口座で運用して、動作を確認してください

3. **リスク管理**
   - リアル口座に移行する場合は、小額から開始してください
   - 失っても問題ない金額以内で運用してください

## サポート

問題が解決しない場合：

1. ログファイルを確認：`logs/fx_autotrade.log`
2. MT5のログを確認：「ツールボックス」→「ジャーナル」タブ
3. GitHubのIssueで質問（個人情報は含めないでください）

---

**最終更新日**: 2025-10-23
