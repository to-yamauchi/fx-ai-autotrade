# ログ出力の改善

## 変更内容

### 改善前（冗長なログ）

各日ごとに複数行の詳細ログが出力されていました：

```
📅 2024-09-01
🔍 Phase 1: デイリーレビュー (06:00)...
   ✓ スコア: 75/100点
🌅 Phase 2: 朝の詳細分析 (08:00)...
   ✓ バイアス: BUY, 信頼度: 75%, トレード: ○
⏰ Phase 3: 定期更新 (12:00, 16:00, 21:30)...
   ✓ 完了
📈 Phase 4&5: リアルタイム監視中... ✓ 監視: 96回, 緊急: 0回
💰 残高: 1,000,000円, ポジション: 1個
```

### 改善後（簡潔なログ）

各日ごとに1行サマリーのみ表示：

```
📅 2024-09-01 | バイアス:BUY | 新規:1件 | 決済:0件 | 損益:+0円 | 残高:1,000,000円 | ポジション:1個
📅 2024-09-02 | バイアス:SELL | 新規:0件 | 決済:1件 | 損益:+15,000円 | 残高:1,015,000円 | ポジション:0個
📅 2024-09-03 | バイアス:NEUTRAL | 残高:1,015,000円 | ポジション:0個
📅 2024-09-04 | バイアス:BUY | 新規:1件 | 決済:0件 | 損益:+0円 | 残高:1,015,000円 | ポジション:1個 | ⚠️緊急:1回
```

### 表示ルール

1. **常に表示される項目**
   - 📅 日付
   - バイアス（BUY/SELL/NEUTRAL）
   - 残高
   - ポジション数

2. **トレードがあった場合のみ表示**
   - 新規エントリー数
   - 決済数
   - 損益（+または-）

3. **緊急対応があった場合のみ表示**
   - ⚠️緊急: X回

## エラー表示

エラーが発生した場合は、必ずコンソールに詳細を出力します：

```
❌ Phase 1エラー（デイリーレビュー失敗）: Connection timeout
❌ Phase 2エラー（ティックデータ読み込み失敗）
❌ Phase 3エラー（定期更新失敗 12:00）: API rate limit exceeded
❌ Phase 4エラー（Layer 3a監視失敗）: Invalid position data
❌ Phase 5エラー（Layer 3b緊急評価失敗）: Emergency evaluation error
❌ AI分析エラー (2024-09-01 08:00:00): Model not available
❌ トレード実行エラー: Insufficient margin
❌ 異常検知エラー: Price data missing
```

### エラーの特徴

- ❌ マークで視覚的に目立つ
- どのPhaseで発生したかが明確
- 具体的なエラーメッセージを表示
- ログファイルには完全なスタックトレースを記録

## バックテスト開始時のログ

```
================================================================================
バックテスト開始
================================================================================
期間: 2024-09-01 ～ 2024-09-30
初期残高: 1,000,000円
AIモデル: pro

📊 データ読み込み中...
✓ 1,234,567ティック読み込み完了

🔄 バックテスト実行中...
================================================================================
```

## バックテスト終了時のログ

```
================================================================================
バックテスト完了
================================================================================

================================================================================
📊 バックテスト結果
================================================================================

期間: 2024-09-01 ～ 2024-09-30 (30日間)

初期残高:        1,000,000円
最終残高:        1,150,000円
損益:              150,000円
リターン:             15.00%

総トレード数:            25回
勝ちトレード:            18回
負けトレード:             7回
勝率:                 72.00%

総利益:            250,000円
総損失:           -100,000円
平均利益:           13,889円
平均損失:          -14,286円
プロフィットファクター:     2.50

最大ドローダウン:     -50,000円 (5.00%)
```

## メリット

### 1. 視認性の向上
- 1日1行なので、複数日の推移が一目で分かる
- トレード状況が素早く確認できる
- スクロールが少なくて済む

### 2. エラーの明確化
- エラーが発生した場合は必ず❌付きで表示
- どのPhaseで問題が起きたかすぐに分かる
- エラーメッセージが明確

### 3. 柔軟性
- トレードがあった日だけ詳細を表示
- 緊急対応があった場合は警告を表示
- 必要な情報だけを表示

## ログファイル

コンソールは簡潔にしつつ、ログファイルには詳細を記録：
- エラー時は完全なスタックトレース
- 各Phaseの処理結果
- データベース保存の成否
- AIモデルの応答内容

## 出力例（実際のバックテスト）

```
================================================================================
バックテスト開始
================================================================================
期間: 2024-09-01 ～ 2024-09-07
初期残高: 1,000,000円
AIモデル: pro

📊 データ読み込み中...
✓ 245,678ティック読み込み完了

🔄 バックテスト実行中...
================================================================================
📅 2024-09-01 | バイアス:BUY | 新規:1件 | 残高:1,000,000円 | ポジション:1個
📅 2024-09-02 | バイアス:BUY | 新規:1件 | 決済:1件 | 損益:+12,500円 | 残高:1,012,500円 | ポジション:1個
📅 2024-09-03 | バイアス:NEUTRAL | 決済:1件 | 損益:+8,200円 | 残高:1,020,700円 | ポジション:0個
📅 2024-09-04 | バイアス:SELL | 新規:1件 | 残高:1,020,700円 | ポジション:1個
📅 2024-09-05 | バイアス:SELL | 決済:1件 | 損益:-5,300円 | 残高:1,015,400円 | ポジション:0個
📅 2024-09-06 | バイアス:NEUTRAL | 残高:1,015,400円 | ポジション:0個
📅 2024-09-07 | バイアス:BUY | 新規:1件 | 残高:1,015,400円 | ポジション:1個

================================================================================
バックテスト完了
================================================================================

📊 バックテスト結果
================================================================================

期間: 2024-09-01 ～ 2024-09-07 (7日間)

初期残高:        1,000,000円
最終残高:        1,015,400円
損益:               15,400円
リターン:              1.54%

総トレード数:             4回
勝ちトレード:             3回
負けトレード:             1回
勝率:                 75.00%

総利益:             20,700円
総損失:             -5,300円
平均利益:            6,900円
平均損失:           -5,300円
プロフィットファクター:     3.91

最大ドローダウン:      -5,300円 (0.52%)

```

## まとめ

- **簡潔**: 各日1行、トレード状況のみ
- **明確**: エラーは必ず❌付きで表示
- **効率的**: スクロール不要で全体把握
- **柔軟**: トレードがあった日だけ詳細表示

この変更により、バックテストの進行状況を素早く把握でき、問題があった場合もすぐに特定できるようになりました。
