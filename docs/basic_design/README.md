# 基本設計書（アーキテクチャ概要）

## 概要

このディレクトリには、FX自動トレードシステムの**基本設計レベル**のアーキテクチャドキュメントが含まれています。

基本設計書は、システム全体の大まかな構成、主要コンポーネントの役割、データフローなどを概念レベルで説明します。
実装の詳細については、[詳細設計書](../architecture/)を参照してください。

---

## ドキュメント一覧

### システム全体

| ドキュメント | 説明 |
|-------------|------|
| [ARCHITECTURE_OVERVIEW.md](../ARCHITECTURE_OVERVIEW.md) | システム全体のアーキテクチャ概要 |

### 主要アーキテクチャ

| No. | ドキュメント | アーキテクチャ | 説明 |
|-----|-------------|--------------|------|
| 01 | [data_processing_architecture.md](./01_data_processing_architecture.md) | データ処理アーキテクチャ | 市場データの取得と標準化 |
| 02 | [ai_analysis_architecture.md](./02_ai_analysis_architecture.md) | AI分析アーキテクチャ | 市場分析と戦略生成 |
| 03 | [rule_execution_architecture.md](./03_rule_execution_architecture.md) | ルール実行アーキテクチャ | 高速なルール実行と監視 |
| 04 | [risk_management_architecture.md](./04_risk_management_architecture.md) | リスク管理アーキテクチャ | 多層防御と口座保護 |

---

## ドキュメント構成

### 基本設計 vs 詳細設計

| 項目 | 基本設計 | 詳細設計 |
|------|---------|---------|
| **目的** | 何を作るか、どう構成するか | 具体的にどう実装するか |
| **レベル** | 概念レベル | 実装レベル |
| **内容** | 役割、責務、データフロー | API仕様、データ構造、処理ロジック |
| **対象読者** | プロジェクトマネージャー、設計者 | 開発者、実装担当者 |
| **詳細度** | 大まかな構成 | 細かい仕様 |

### 基本設計書の構成

各基本設計書は以下の構成で記載されています：

1. **概要**: 役割と位置づけ
2. **アーキテクチャ構成**: 全体像とコンポーネント
3. **主要コンポーネント**: 各部の責務
4. **データフロー**: データの流れ
5. **設計原則**: アーキテクチャの原則
6. **技術選定**: 主要技術（概要）
7. **まとめ**: 特徴と次のステップ

---

## アーキテクチャの全体像

```
┌─────────────────────────────────────────────────┐
│              スケジューラ                         │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│         データ処理アーキテクチャ                   │
│  MT5接続 → 時間足変換 → 指標計算 → 標準化        │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│          AI分析アーキテクチャ                      │
│  振り返り → 朝分析 → 定期更新 → ポジション監視    │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│        ルール実行アーキテクチャ                    │
│  エントリー監視 → 3層監視 → 決済監視             │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│             MT5 トレード実行                      │
└─────────────────────────────────────────────────┘

        ← リスク管理アーキテクチャ（横断的）→
```

---

## 主要アーキテクチャの概要

### 1. データ処理アーキテクチャ

**役割**: 市場データの取得と標準化

**主要機能**:
- MT5からのデータ取得
- 複数時間足への変換
- テクニカル指標の計算
- AI解釈可能な標準フォーマットへの変換

**特徴**:
- 確定的処理（再現性）
- 高速処理（3秒以内）
- 異常値検出

### 2. AI分析アーキテクチャ

**役割**: 市場分析と実行可能な戦略生成

**主要機能**:
- 前日の振り返りと学習
- 朝の詳細分析と戦略生成
- 定期的な戦略妥当性確認
- ポジション保有中の再評価

**特徴**:
- 階層化された分析（戦略層・調整層・監視層）
- コスト最適化（月$1.43）
- 適応的学習

### 3. ルール実行アーキテクチャ

**役割**: AI生成ルールの高速実行と監視

**主要機能**:
- エントリー条件の継続監視
- 3層監視システム（Layer 1/2/3）
- 決済条件の監視と実行

**特徴**:
- 高速処理（100ms〜1分）
- 多層防御
- AI判断を待たない機械的実行

### 4. リスク管理アーキテクチャ

**役割**: 多層防御による口座保護

**主要機能**:
- 4層の防御システム
- ポジションサイズ管理
- ドローダウン管理
- 定期レビュー

**特徴**:
- 安全性最優先
- 段階的対応
- 継続的改善

---

## 設計原則

システム全体を貫く4つの設計原則：

### 1. 再現性の確保

**原則**: 同じ市場データから同じ判断を生成

- データ処理: 確定的な計算
- AI分析: 低温度パラメータ（0.3）
- 全データ・判断の記録

### 2. 安全性最優先

**原則**: 緊急停止は完全ルールベース

- 多層防御システム
- AI判断を待たない即座の対応
- システム障害時の保護継続

### 3. 柔軟な進化

**原則**: AIが市場変化に適応

- 日次の戦略更新
- 前日の振り返りからの学習
- 市場環境への適応

### 4. 段階的実装

**原則**: 基礎から順に構築

- 6フェーズのロードマップ
- 各段階での検証
- デモ運用を経て本番へ

---

## 技術スタック概要

### プログラミング言語
- **Python 3.10+**: メインシステム

### 主要API・ライブラリ
- **MetaTrader5 API**: 市場データ取得、注文実行
- **Gemini API**: AI分析（従量課金）
- **PostgreSQL**: データ永続化
- **pandas / numpy**: データ処理

### インフラ
- **Linux (Ubuntu推奨)**: 実行環境
- **VPS (オプション)**: 24時間稼働

### コスト
- **AIコスト**: 月$1.43（Gemini従量課金）
- **VPS**: $0〜30/月（オプション）
- **合計**: $1.43〜31/月

---

## 関連ドキュメント

### 詳細設計書

詳細な実装仕様は以下を参照：

- [architecture/](../architecture/) - 各コンポーネントの詳細設計書

### 全体仕様書

- [FX_AUTO_TRADE_SPECIFICATION.md](../../FX_AUTO_TRADE_SPECIFICATION.md) - システム全体の詳細仕様

---

## 読み方ガイド

### 初めて読む方

1. **まず**: [ARCHITECTURE_OVERVIEW.md](../ARCHITECTURE_OVERVIEW.md) でシステム全体を理解
2. **次に**: 興味のあるアーキテクチャの基本設計書を読む
3. **詳細が必要なら**: 対応する詳細設計書へ

### 実装担当者

1. **基本設計書**: アーキテクチャの全体像を把握
2. **詳細設計書**: 実装に必要な詳細仕様を確認
3. **全体仕様書**: 他コンポーネントとの連携を理解

### プロジェクトマネージャー

1. **ARCHITECTURE_OVERVIEW.md**: システム全体の理解
2. **各基本設計書**: 主要コンポーネントの役割把握
3. **実装ロードマップ**: 段階的実装計画の確認

---

## 更新履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2025-10-21 | 1.0 | 初版作成 |

---

**基本設計書は、システムの大まかな構成を理解するためのドキュメントです。**
**実装の詳細は詳細設計書を参照してください。**
